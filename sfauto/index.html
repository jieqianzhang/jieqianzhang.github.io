<!DOCTYPE html>
<meta charset="utf-8">
<html>

<head>
    <link rel="stylesheet" href="bootstrap.min.css">
    <link href='http://fonts.googleapis.com/css?family=Abel' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
</head>
<style>
rect.bordered {
    stroke: #1d1d1d;
    stroke-width: 2px;
}

text.mono {
    font-size: 9pt;
    font-family: "Abel";
    fill: #aaa;
}

text.axis-workweek {
    fill: white;
}

text.mono.axis-worktime {
    fill: white;
}

text.axis-worktime {
    fill: #000;
}

body {
    background-color: #1d1d1d;
}

.btn-group {
    margin-left: 80px;
    margin-top: 30px;
}

button {
    font-family: "Abel", courier;
}

.title {
    color: white;
    margin-left: 30px;
    font-family: Garamond;
    margin-left: 80px;
}

.credit, .source, .note, .instruction, .special{
    color:white;
    margin-left: 30px;
    font-family: Garamond;
    margin-left: 80px;
}

.highlight{
    color: grey;
}


</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>

<body>
   
    <h2 class="title"> When could you most likely get a car break-ins in San Francisco? </h2>
    <p class="credit"> By Jieqian Zhang </p>
    <p class="source"> Source: <a href="https://data.sfgov.org/Public-Safety/SFPD-Incidents-from-1-January-2003/tmnf-yvry"/> San Francisco Open Data</a> </p>
    <p class="note"> <strong> Note: </str> I got this idea of looking into crime data on car break-ins from many of my friends' experiences in San Francisco. Many of them got their cars  smashed and belongings grabbed. The data is from SF Open Data, and I cleaned it with R and visualized it with d3.js. A webapp with geolocator and filters is coming up to give users a better understanding of how safe it is to park their cars at a certain locaiton during a certain period of time. Stay tuned! </p>
    <p class="instruction"> <strong class="highlight">Instruction: </strong>Click through the years to see the most likely time of a day that you could get your car broken-into in San Francisco. The heatmap is color-coded by the numbers of car break-in cases reported to SFPD. </p>
    <p class="special"> * The data of 2015 is updated to the month of July.</p>

    
    <div id="main" role="main">
        <div class="btn-group" data-toggle="buttons-radio">
            <button type="button" id="a" class="btn switch" value="2003">2003</button>
            <button type="button" id="b" class="btn switch" value="2004">2004</button>
            <button type="button" id="c" class="btn switch">2005</button>
            <button type="button" id="d" class="btn switch">2006</button>
            <button type="button" id="e" class="btn switch">2007</button>
            <button type="button" id="f" class="btn switch">2008</button>
            <button type="button" id="g" class="btn switch">2009</button>
            <button type="button" id="h" class="btn switch">2010</button>
            <button type="button" id="i" class="btn switch">2011</button>
            <button type="button" id="j" class="btn switch">2012</button>
            <button type="button" id="k" class="btn switch">2013</button>
            <button type="button" id="l" class="btn switch">2014</button>
            <button type="button" id="m" class="btn switch active">2015</button>
        </div>
        <div id="vis"></div>
    </div>
    <div id="chart"></div>
    <script type="text/javascript">

    var margin = {
            top: 50,
            right: 0,
            bottom: 100,
            left: 80
        },
        width = 960 - margin.left - margin.right,
        height = 430 - margin.top - margin.bottom,
        gridSize = Math.floor(width / 24),
        // legendElementWidth = gridSize*2,
        legendElementWidth = gridSize * 2.4,
        buckets = 9,
        colors = ["#ffffcc", "#ffeda0", "#fed976", "#feb24c", "#fd8d3c", "#fc4e2a", "#e31a1c", "#bd0026", "#800026", "#450211"], 
        days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"],
        times = ["1a", "2a", "3a", "4a", "5a", "6a", "7a", "8a", "9a", "10a", "11a", "12a", "1p", "2p", "3p", "4p", "5p", "6p", "7p", "8p", "9p", "10p", "11p", "12p"];

    var dataAll

    d3.tsv("data.tsv",

    function(error, result) {
        dataAll = result;
        var data = [];    
        var data = dataAll.filter(function(d,i){
            if(d.year == "2015"){
                return d;
            }
        });

    var colorScale = d3.scale.quantile()
        .domain([0, 400])
        .range(colors);

    var svg = d3.select("#chart").append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        // .call(responsivefy)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    var dayLabels = svg.selectAll(".dayLabel")
        .data(days)
        .enter().append("text")
        .text(function(d) {
            return d;
        })
        .attr("x", 0)
        .attr("y", function(d, i) {
            return i * gridSize;
        })
        .style("text-anchor", "end")
        .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
        .attr("class", function(d, i) {
            return ((i >= 0 && i <= 4) ? "dayLabel mono axis axis-workweek" : "dayLabel mono axis");
        });

    var timeLabels = svg.selectAll(".timeLabel")
        .data(times)
        .enter().append("text")
        .text(function(d) {
            return d;
        })
        .attr("x", function(d, i) {
            return i * gridSize;
        })
        .attr("y", 0)
        .style("text-anchor", "middle")
        .attr("transform", "translate(" + gridSize / 2 + ", -6)")
        .attr("class", function(d, i) {
            return ((i >= 7 && i <= 16) ? "timeLabel mono axis axis-worktime" : "timeLabel mono axis");
        });

    var heatMap = svg.selectAll(".hour")
        .data(data)
        .enter().append("rect")
        .attr("x", function(d) {
            return (d.hour - 1) * gridSize;
        })
        .attr("y", function(d) {
            return (d.day - 1) * gridSize;
        })
        .attr("rx", 4)
        .attr("ry", 4)
        .attr("class", "hour bordered")
        .attr("width", gridSize)
        .attr("height", gridSize)
        .style("fill", colors[0]);

    heatMap.transition().duration(1000)
    .style("fill", function(d) {
        return colorScale(d.value);
    });

    heatMap.append("title").text(function(d) {
        return d.value;
    });

    var legend = svg.selectAll(".legend")
        .data([0].concat(colorScale.quantiles()), function(d) {
            return d;
        })
        .enter().append("g")
        .attr("class", "legend");

    legend.append("rect")
    .attr("x", function(d, i) {
        return legendElementWidth * i;
    })
    .attr("y", height)
    .attr("width", legendElementWidth)
    .attr("height", gridSize / 2)
    .style("fill", function(d, i) {
        return colors[i];
    });

    legend.append("text")
    .attr("class", "mono")
    .text(function(d) {
        return Math.round(d);
    })
    .attr("x", function(d, i) {
        return legendElementWidth * i;
    })
    .attr("y", height + gridSize);

    //update data

    $(".btn").on("click",function(){
        $(".btn").removeClass("active");
        $(this).addClass("active");
        var currentyear = $(this).text();
        data = []; 
        data = dataAll.filter(function(d,i){

            if(d.year == currentyear){
                return d;
            }
        });

        svg.selectAll(".hour")
        .data(data)
        .transition()
        .duration(600)
        .style("fill", function(d) {
        return colorScale(d.value);
    });


        


    })
    
    });

  


    // function responsivefy(svg) {

    //     var container = d3.select(svg.node().parentNode),
    //         width = parseInt(svg.style("width")),
    //         height = parseInt(svg.style("height")),
    //         aspect = width / height;

    //     svg.attr("viewBox", "0 0 " + width + " " + height)
    //         .attr("perserveAspectRatio", "xMinYMid")
    //         .call(resize);

    //     d3.select(window).on("resize." + container.attr("#graphic"), resize);

    //     function resize() {
    //         var targetWidth = parseInt(container.style("width"));
    //         svg.attr("width", targetWidth * 0.8);
    //         svg.attr("height", Math.round(targetWidth / aspect * 0.8));
    //     }
    // }

    </script>
</body>

</html>